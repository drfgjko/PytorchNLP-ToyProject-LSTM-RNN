# RNN/LSTM进行文本生成

## 前言

结课答辩准备匆忙，注释可能有写错的地方

## 项目说明

个人根据bilibili某一RNN文本处理教学视频及一篇文本生成文章（上述提及已丢失链接）完成的项目代码，为NLP课程的阶段性学习成果展示

## 使用说明

在main.py中运行主函数即可

- 模型已经训练好（通过修改mode，可以训练新模型）
- out_poem = test(word)，使用LSTM生成诗歌
- out_poem = test(word，2)，使用RNN生成诗歌

## 项目要求

1. 熟悉各种网络的框架，能熟练使用Pytorch搭建神经网络，了解每一个模块的作用；
2. 熟悉自然语言处理领域中对数据的预处理方法；
3. 要求使用多种网络（RNN、CNN或是它们的变体）实验，记录网络表现情况，并且进行对比；

## 数据集

- 主页:

https://github.com/chinese-poetry/chinese-poetry

- 本项目使用部分:

https://github.com/chinese-poetry/chinese-poetry/tree/master/%E5%85%A8%E5%94%90%E8%AF%97

## 实现过程

### 数据处理

在Data.py文件中

- 定义json_to_txt函数：将.json文件的诗歌数据录入到.txt文件中

- 定义split_poetry函数: 拆分(每个字以空格分开) -> 存入'./dataset/song_split.txt'

- 定义train_vec函数：建立词向量模型，对数据，key_to_index, index_to_key进行处理

### 组合模型_定义LSTM模型

在mymodel_lstm.py文件中

- 定义MyLstmModel：完成数据封装，将词的索引转换为词嵌入向量；一个基于 LSTM 的循环神经网络模型，用于生成诗歌。

### 定义RNN模型

在mymodel_rnn.py文件中

- 定义MyRnnModel：完成数据封装，将词的索引转换为词嵌入向量；一个基于 RNN 的循环神经网络模型，用于生成诗歌。

### 训练

在train.py文件中

- 定义get_data_args函数：训练词向量，返回后续需要的参数

- 定义get_args函数：模型训练的基本参数定义及获取

- 定义train_model函数： 
初始化词嵌入层和模型
定义损失函数    cross_entropy(交叉函数损失)
生成批次数据并处理，计算损失进行反向传播
保存模型

### 诗歌生成

在main.py文件中：

- 定义test函数：加载模型，进行诗歌生成

- 定义load_model函数：加载模型

- 定义generate_poem函数：进行诗歌生成


## 效果展示

- 使用LSTM
一些字在训练数据中出现频率较高,模型在生成文本时过度依赖这些熟悉的词语组合。

>请输入一个字:夜
夜来风雨湿春风，一夜风流不可知。不是春风吹不得，不知谁是一枝春。

> 请输入一个字:雨
雨过风光不可攀，一杯聊复见春风。不知此地无人会，不是人间不得知。

> 请输入一个字:水
水晶宫殿倚帘栊，一点春风一点红。不是春风吹不得，不知谁是一枝春。

> 请输入一个字:恋
恋君不是山中路，一夜风流不可知。不是此生无一事，不知谁是一般诗。

- 使用RNN
一些字在训练数据中出现频率较高,模型在生成文本时过度依赖这些熟悉的词语组合。

> 请输入一个字:春
春风吹雨湿黄昏，一点春风一点红。不是春风吹不断，不知春色不须知。

> 请输入一个字:明
明月风流一点红，一番风雨湿青山。不知不是无人事，不似春风吹落花。

- 改进：在生成诗歌的函数里添加了“预测概率分布进行加权随机选择”的逻辑，而不是简单选择选择概率最高的那个预测字；这样能让诗歌生成看起来更多样一些，但还是存在雷同。后续改进应获取上下文信息。

> 请输入一个字:谁
谁能一点不能回，不得东风未肯留。谁为此时人不得，一春色更无穷。

> 请输入一个字:他
他时不得一般风，一夜寒烟满地明。今日无情不知否，却寻风雨入西风。

> 请输入一个字:可
可怜春色不堪归，更喜春阴满目开。不似人间多谢恨，更将春色已为谁。

>请输入一个字:明
明月山中月下天，春光无意不能开。不知谁是东山去，只有山中是故人。

>请输入一个字:却
却有南湖一片春，一般如此不相逢。何须更得南山梦，不是春寒有一年。

>请输入一个字:笑
笑向人间有几年，何如云水一番春。山头一夜无人见，一夜风流一夜来。


## 实验环境

### Python

- Python 3.12.3 (tags/v3.12.3:f6650f9, Apr  9 2024, 14:05:25) [MSC v.1938 64 bit (AMD64)] on win32

### Pytorch
- torch                       2.3.0

## 学习总结

1. conda管理python虚拟环境
2. 能够处理环境依赖冲突
3. 可利用Pytorch搭建神经网络
4. 初步理解神经网络结构RNN及LSTM

## 署名

22软工dqy
